# Module 7 – Fiber Laser

## 6. CNC Integration: Laser Control, M-Code Programming, and Toolpath Optimization

### 6.1 Laser Power Control Signal Architectures

CNC control of laser output power enables dynamic modulation during cutting operations—reducing power for tight corners (prevents overburn), ramping power during pierce cycles (avoids material blowback), and adjusting intensity for variable material thickness. Three primary control methods provide varying levels of precision, response time, and implementation complexity.

**1. Analog Voltage Control (0-10 VDC):**

Most common interface: CNC analog output (0-10 V) controls laser power from 0-100%:

$$P_{laser} = P_{max} \times \frac{V_{command}}{10}$$

where:
- $P_{laser}$ = actual laser output (W)
- $P_{max}$ = maximum rated power (W)
- $V_{command}$ = CNC analog output voltage (0-10 V)

**Advantages:**
- Simple wiring (2-wire shielded cable)
- Universal compatibility (standard on 95% of CNC controllers)
- Fast response (<10 ms typical)

**Disadvantages:**
- Susceptible to electrical noise (±0.1 V error = ±1% power variation)
- Requires calibration (voltage-to-power linearity verification)
- Limited to single control variable (power only, no status feedback)

**2. PWM (Pulse Width Modulation) Control:**

Digital on/off pulses with variable duty cycle:

$$P_{avg} = P_{max} \times \frac{t_{on}}{t_{on} + t_{off}}$$

where:
- $P_{avg}$ = average laser power (W)
- $t_{on}$ = pulse on-time (μs)
- $t_{off}$ = pulse off-time (μs)

**Typical PWM frequency:** 1-20 kHz (must exceed 2× cutting speed / kerf width to prevent ripple marks)

**Advantages:**
- Immune to electrical noise (digital signal)
- No calibration drift (duty cycle defined by timing, not analog levels)
- Can achieve finer resolution than 10-bit DAC (0.1% steps with 1 kHz PWM)

**Disadvantages:**
- Requires laser source with fast modulation capability (<100 μs response time)
- Complex wiring (requires pull-up resistor and noise filtering)
- May cause cutting artifacts if PWM frequency too low (<1 kHz)

**3. Digital Fieldbus Communication (Modbus RTU, EtherCAT, PROFINET):**

Bidirectional digital communication provides comprehensive control and monitoring:

**Typical Modbus RTU command set:**
- Register 0x1000: Power setpoint (0-100%, 16-bit resolution = 0.0015% steps)
- Register 0x1001: Power enable (0 = standby, 1 = emission)
- Register 0x2000: Actual output power (readback for closed-loop control)
- Register 0x2001: Status word (ready, fault, interlock, temperature warning)
- Register 0x2010: Fault code (identifies specific error: overtemp, fiber break, etc.)

**Communication parameters:**
- Baud rate: 9,600-115,200 bps (19,200 typical for laser control)
- Protocol: Modbus RTU over RS-485 (2-wire differential, up to 1,200 m)
- Update rate: 10-100 Hz (100 ms typical, adequate for most cutting applications)

**Advantages:**
- Bidirectional: CNC reads laser status, faults, and actual power
- High resolution: 16-bit power control (65,536 steps vs. 1,000 for 0-10 V)
- Multi-parameter: Simultaneous control of power, pulse parameters, gas pressure
- Diagnostic capability: Fault identification without external tools

**Disadvantages:**
- Requires CNC with fieldbus capability (premium controllers only)
- Complex programming (Modbus protocol stack)
- Slower response than analog (100 ms vs. 10 ms for emergency shutdown)

**Selection guideline:**
- Analog 0-10 V: General-purpose cutting, standard CNC controllers
- PWM: High-precision applications requiring fine power modulation
- Modbus/Fieldbus: Production environments with automated fault handling and process monitoring

### 6.2 M-Code Programming for Laser Control

**Standard M-Codes (per ISO 6983 / RS-274):**

| M-Code | Function | Parameters | Example |
|--------|----------|------------|---------|
| **M3 Sxxxx** | Laser on (CW mode) | S = power (0-100%) | M3 S75 (75% power) |
| **M4 Sxxxx** | Laser on (pulsed mode) | S = frequency (Hz) | M4 S5000 (5 kHz pulse) |
| **M5** | Laser off (standby) | None | M5 |
| **M7/M8** | Assist gas on (mist/flood) | None | M8 (gas on) |
| **M9** | Assist gas off | None | M9 |
| **M10/M11** | Clamp/unclamp workpiece | None | M10 (clamp) |

**Custom M-Codes (machine-specific):**

| M-Code | Function | Application |
|--------|----------|-------------|
| **M100** | Pierce cycle | Executes programmed pierce parameters (power ramp, delay) |
| **M101** | Auto-focus | Triggers capacitive height sensor calibration |
| **M102** | Nozzle change | Positions head for manual nozzle replacement |
| **M103** | Gas pressure adjust | Switches between cutting/piercing pressure setpoints |

**Example G-Code Sequence for Laser Cutting:**

```gcode
% (Program start)
O1234 (Part: Bracket-001, Material: SS304 3mm)

(Setup and initialization)
G90 G54 G21 (Absolute mode, work coordinate system 1, metric units)
M8 (Assist gas on - nitrogen 1.5 MPa)
G0 X10 Y10 Z5 (Rapid to start position, Z above workpiece)

(Pierce sequence for first contour)
M100 (Execute pierce cycle - auto power ramp and delay)
G4 P0.8 (Dwell 0.8 seconds for pierce completion)

(Cutting sequence - outer contour)
M3 S85 (Laser on, 85% power for 3mm stainless)
G1 X100 Y10 F4000 (Linear cut at 4 m/min)
G3 X110 Y20 I0 J10 F3500 (Arc, reduce speed for curve)
G1 X110 Y80 F4000 (Straight section, full speed)
G3 X100 Y90 I-10 J0 F3500 (Arc)
G1 X10 Y90 F4000
G1 X10 Y10 (Return to start, close contour)

(Laser off, reposition for next feature)
M5 (Laser standby)
G0 X50 Y50 Z5 (Rapid to next pierce location)

(Second feature - inner cutout)
M100 (Pierce)
G4 P0.6 (Shorter pierce for thinner material)
M3 S80 (Slightly lower power for small feature)
G2 X50 Y50 I10 J0 F3000 (Circular cutout, 10mm radius, 3 m/min)

M5 (Laser off)
M9 (Gas off)
G0 Z50 (Retract to clearance height)
M30 (Program end, rewind)
%
```

### 6.3 Pierce Strategies and Power Ramping

**Pierce Challenges:**

Initiating a cut (pierce) differs from through-cutting due to:
1. **Full material thickness:** No pre-existing kerf to guide melt ejection
2. **Blowback risk:** Molten material can eject upward onto protective window (if power too high)
3. **Incomplete penetration:** Insufficient power or time leaves solid material at bottom

**Pierce Power Ramp Profile:**

$$P(t) = \begin{cases}
P_{pierce} & 0 \leq t < t_1 \\
P_{pierce} + \frac{(P_{cut} - P_{pierce})}{t_2 - t_1}(t - t_1) & t_1 \leq t < t_2 \\
P_{cut} & t \geq t_2
\end{cases}$$

where:
- $P_{pierce}$ = initial pierce power (typically 30-60% of $P_{cut}$)
- $P_{cut}$ = full cutting power
- $t_1$ = initial low-power phase duration (0.1-0.3 s)
- $t_2$ = ramp completion time (0.3-0.8 s total)

**Example 6.1: Pierce Parameter Calculation for 6mm Stainless Steel**

**Given:**
- Material: SS304, 6 mm thick
- Cutting power: $P_{cut} = 5,000$ W (83% of 6 kW laser)
- Cutting speed: 2.5 m/min

**Determine pierce parameters:**

**Step 1: Initial pierce power** (rule of thumb: 40-50% of cutting power)
$$P_{pierce} = 0.45 \times 5000 = 2,250 \text{ W}$$

**Step 2: Low-power phase duration** (empirical: 0.05 s per mm thickness)
$$t_1 = 0.05 \times 6 = 0.3 \text{ s}$$

**Step 3: Ramp duration** (empirical: 0.10 s per mm thickness)
$$t_2 = 0.10 \times 6 = 0.6 \text{ s}$$

**Step 4: Verify gas pressure**
Pierce pressure = 1.8-2.0 MPa (higher than cutting pressure of 1.5 MPa for faster melt ejection)

**Programmed sequence:**
1. Position laser over pierce point
2. Enable gas at 2.0 MPa
3. Laser on at 2,250 W for 0.3 s
4. Ramp power to 5,000 W over 0.3 s (0.3-0.6 s elapsed)
5. Begin motion at 2.5 m/min with 5,000 W

**Total pierce time:** 0.6 s + 0.2 s safety margin = 0.8 s (programmed with G4 P0.8 dwell)

### 6.4 Corner and Contour Speed Modulation

**Overburn at Sharp Corners:**

When CNC decelerates for direction change, constant laser power causes localized overheating:

$$E_{deposited} = \frac{P \cdot t}{A} = \frac{P}{v \cdot w}$$

where:
- $E$ = energy per unit area (J/mm²)
- $P$ = laser power (W)
- $v$ = cutting speed (mm/s)
- $w$ = kerf width (mm)
- $t/A$ = dwell time per unit area

At sharp corner (90°), instantaneous velocity drops to zero, creating infinite energy density → **corner overburn** (melted corner radius 0.5-2 mm).

**Mitigation Strategy 1: Power Modulation in Corners**

Reduce laser power proportional to velocity reduction:

$$P_{corner} = P_{cut} \times \frac{v_{corner}}{v_{cut}}$$

**Example:** Cutting at 4,000 mm/min (67 mm/s), corner deceleration to 1,000 mm/min (17 mm/s):
$$P_{corner} = P_{cut} \times \frac{17}{67} = 0.25 \times P_{cut}$$

Reduce power to 25% during corner traverse to maintain constant energy density.

**Implementation:**
- CNC analog output tracks commanded feedrate (requires real-time synchronization)
- Look-ahead buffer predicts upcoming velocity changes 50-200 ms ahead
- Power modulation smoothed with 20-50 ms time constant to avoid instability

**Mitigation Strategy 2: Lead-In/Lead-Out Paths**

Add curved approach/departure paths to avoid zero-velocity condition:

**Recommended lead-in length:** $L_{lead} = 2-5 \times$ kerf width (0.5-2 mm typical)
- **Arc lead-in:** Tangent arc entry, radius = 1-3 mm
- **Straight lead-in:** Perpendicular or angled entry from scrap area

CAM software automatically inserts lead-ins; manual programming requires G2/G3 arc commands.

### 6.5 Kerf Offset Compensation

**Kerf Width and Compensation:**

Laser cutting removes material width equal to kerf (0.1-0.4 mm depending on material, thickness, and focus):

- **Inside contours (holes):** Toolpath offset outward by kerf/2 to achieve programmed hole diameter
- **Outside contours (part perimeter):** Toolpath offset inward by kerf/2

**Kerf width estimation:**

$$w_{kerf} = d_{spot} + 2 \times d_{HAZ}$$

where:
- $d_{spot}$ = focused spot diameter (0.1-0.2 mm)
- $d_{HAZ}$ = heat-affected zone width (0.05-0.15 mm per side)

**CAM software** applies kerf compensation automatically when "Cutter Compensation" set to "On" with kerf width specified (typically 0.15-0.30 mm for fiber laser cutting).

**Manual G-code compensation:**

```gcode
G41 D01 (Cutter compensation left, offset = D01 value)
G1 X100 Y100 (Approach feature)
G2 I-50 J0 (Machine circular hole, CNC applies offset)
G40 (Cancel compensation)
```

### 6.6 Height Control Integration

**Capacitive Height Sensing:**

Maintains constant standoff (0.5-2.0 mm) between nozzle and workpiece by measuring capacitance between nozzle (electrode) and conductive workpiece:

$$C = \frac{\varepsilon_0 \varepsilon_r A}{d}$$

where:
- $C$ = capacitance (pF)
- $ε_0$ = permittivity of free space
- $ε_r$ = relative permittivity of air (~1.0)
- $A$ = nozzle face area (mm²)
- $d$ = standoff distance (mm)

**Capacitance-to-voltage converter** outputs 0-10 V:
- 0 V = collision (d = 0)
- 5 V = nominal standoff (d = 1.0-1.5 mm)
- 10 V = excessive gap (d > 3 mm, loss of signal)

**CNC closed-loop control:**

Z-axis servo maintains target voltage (setpoint = 5 V typical) with PID control loop:

$$\Delta Z = K_p \cdot e + K_i \int e \, dt + K_d \frac{de}{dt}$$

where $e = V_{target} - V_{actual}$ is error signal.

**Typical PID gains:**
- $K_p$ = 0.5-2.0 (proportional: immediate response to error)
- $K_i$ = 0.1-0.5 (integral: eliminates steady-state offset)
- $K_d$ = 0.05-0.2 (derivative: damping for stability)

**Height control bandwidth:** 20-100 Hz (sufficient to track warped sheet metal at cutting speeds up to 10 m/min)

### 6.7 Toolpath Optimization for Cycle Time Reduction

**Sequencing Strategies:**

**1. Nested Parts Optimization:**
- Cut all interior features before exterior contours (parts remain fixtured)
- Group similar features (all 5mm holes, then all 10mm holes) to minimize parameter changes
- Lead-in/lead-out paths enter from scrap areas (avoid witness marks on finished edges)

**2. Common-Line Cutting:**
- Adjacent parts share common edge (single cut separates two parts)
- Reduces total cutting length by 10-30% for dense nesting
- Requires careful lead-in placement to avoid microjoints failing prematurely

**3. Chain Cutting:**
- Continuous path through multiple features without laser-off
- Eliminates pierce time between adjacent holes (saves 0.5-1.0 s per hole)
- Limited to features with compatible cutting parameters

**Cycle Time Estimation:**

$$T_{total} = \sum(t_{rapid} + t_{pierce} + t_{cut})$$

where:
- $t_{rapid}$ = rapid traverse time between features ($L_{rapid} / v_{rapid}$)
- $t_{pierce}$ = pierce time per feature (0.3-1.5 s depending on thickness)
- $t_{cut}$ = cutting time ($L_{cut} / v_{cut}$)

**Example 6.2: Cycle Time Optimization**

**Part:** Bracket with 8 holes (10 mm diameter) and perimeter (500 mm length)
**Material:** 3 mm mild steel

**Baseline sequence:** Rapid to each hole → pierce → cut → repeat

Pierce time: 8 holes × 0.4 s = 3.2 s
Cutting time: (8 × 31.4 mm + 500 mm) / 4,000 mm/min = 0.188 min = 11.3 s
Rapid time: 8 moves × 0.5 s = 4.0 s
**Total: 18.5 s**

**Optimized sequence:** Chain-cut all holes → cut perimeter

Pierce time: 1 pierce only = 0.4 s
Cutting time: (8 × 31.4 mm + 500 mm + 7 × 15 mm links) / 4,000 mm/min = 0.206 min = 12.4 s
**Total: 12.8 s**

**Time savings: 31% reduction** (18.5 s → 12.8 s)

### 6.8 Summary and Best Practices

**Key Takeaways:**

1. **Analog 0-10 V control** provides simple, fast laser power modulation ($P = P_{max} \times V/10$) with <10 ms response time, suitable for 95% of applications; Modbus fieldbus offers bidirectional status monitoring for production systems

2. **M3/M5 M-codes** control laser emission per ISO 6983 standard; custom M100-series codes implement application-specific functions (pierce cycles, auto-focus, gas pressure switching)

3. **Pierce power ramping** starts at 40-50% of cutting power for 0.05 s/mm material thickness, then ramps to full power over 0.10 s/mm to prevent blowback and ensure complete penetration through full thickness

4. **Corner power modulation** reduces laser intensity proportional to velocity ($P_{corner} = P_{cut} \times v_{corner}/v_{cut}$) preventing overburn; lead-in/lead-out arcs (1-3 mm radius) avoid zero-velocity conditions

5. **Kerf compensation** offsets toolpath by kerf/2 (typically 0.15-0.30 mm for fiber laser): outward for holes, inward for external contours; CAM software applies automatically when cutter compensation enabled

6. **Capacitive height control** maintains constant standoff (0.5-2.0 mm) measuring nozzle-workpiece capacitance; CNC PID loop adjusts Z-axis servo with 20-100 Hz bandwidth tracking warped sheets at cutting speeds to 10 m/min

7. **Toolpath sequencing** optimizes cycle time by cutting interior features before exterior (parts stay fixtured), common-line cutting adjacent parts (10-30% length reduction), and chain-cutting compatible features (eliminates pierce time between holes)

8. **Cycle time estimation** sums rapid ($L/v_{rapid}$), pierce (0.3-1.5 s per feature), and cutting ($L/v_{cut}$) times; optimization via chain-cutting and nesting reduces total time 20-40% for typical parts

Proper CNC integration translates laser source capability into production-ready cutting system, coordinating power modulation, gas control, height sensing, and motion to achieve consistent quality at maximum throughput—mastering these principles enables commissioning, programming, and optimization of fiber laser cutting operations from prototype one-offs to high-volume manufacturing.

***

*Total: 2,052 words | 9 equations | 2 worked examples | 2 tables*

---

## References

1. **ISO 11553 Series** - Safety of machinery - Laser processing machines
2. **ANSI Z136.1-2014** - Safe Use of Lasers
3. **IEC 60825-1:2014** - Safety of laser products - Equipment classification
4. **Steen, W.M. & Mazumder, J. (2010).** *Laser Material Processing* (4th ed.). Springer
5. **IPG Photonics Fiber Laser Systems Manual** - Industrial laser specifications
6. **Trumpf Laser Technology Handbook** - Laser cutting and welding applications
7. **ISO 9013:2017** - Thermal cutting - Classification of thermal cuts
8. **OSHA Technical Manual Section III: Chapter 6** - Laser Hazards
